<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <link href="./css/prettify.css" type="text/css" rel="stylesheet"/>
    <script src="./js/prettify.js" type="text/javascript"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>TrueVFS Access &#x2013; Configuring TrueVFS Access</title>
    <style type="text/css" media="all">
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print"/>
    <meta name="author" content="Christian Schlichtherle"/>
    <meta name="Date-Revision-yyyymmdd" content="20180601"/>
    <meta http-equiv="Content-Language" content="en"/>
          <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-25500668-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
                  <script>
        (function() {
          var cx = '003580521944097984334:8uinm6tpaz4';
          var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
          gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
              '//www.google.com/cse/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
        })();
      </script>
                                                          
<link rel="alternate" href="http://truevfs.schlichtherle.de/category/announcements/feed/" type="application/rss+xml" title="The TrueZIP Blog - Announcements Feed"/>
                      
  </head>
  <body class="composite" onload="prettyPrint()">
    <div id="banner">
                    <div id="bannerLeft">
                TrueVFS Access
                </div>
                                <div id="gcse-search-form" class="gcse-searchbox-only"></div>
            <div class="clear"><hr/></div>
    </div>
    <div id="breadcrumbs">
            
                                  <div class="xleft">
        <span id="projectVersion">Version: 0.12.0</span>
                  |                         <a href="../index.html" title="TrueVFS">TrueVFS</a>
      &raquo;
                            <a href="./" title="TrueVFS Access">TrueVFS Access</a>
      &raquo;
      TrueVFS Access &#x2013; Configuring TrueVFS Access
              </div>
            <div class="xright">        
                        </div>
      <div class="clear"><hr/></div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
              
                                                   <h5>Documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="About">About</a>
            </li>
                  <li class="none">
                          <a href="usage.html" title="Usage">Usage</a>
            </li>
                  <li class="none">
            <strong>Configuration</strong>
          </li>
          </ul>
                       <h5>Parent Module</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="TrueVFS">TrueVFS</a>
            </li>
          </ul>
                       <h5>Sub-Modules</h5>
                                 <h5>Reports</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                      <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                     
<form method="post" action="https://www.paypal.com/cgi-bin/webscr">
  <div class="paypalButton">
    <input name="cmd" type="hidden" value="_s-xclick"/>
    <input name="hosted_button_id" type="hidden" value="AGDEQWWKNZ6UL"/>
    <input src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!" style="border: 0" type="image"/>
  </div>
</form>
                                
                              </div>
    </div>
    <div id="bodyColumn" class="content">
      <div id="contentBox">
                                      <div class="section">
<h2><a name="Configuring_TrueVFS_Access"></a>Configuring TrueVFS Access</h2>
<p>TrueVFS follows the convention-over-configuration paradigm, so there are reasonable defaults for everything in order to relieve you from typical configuration tasks.</p>
<p>For example, in order to configure the detectable archive file extensions, you just need to make sure that the JAR artifacts of the respective file system driver modules are present on the class path. At run time, the module <a href="../truevfs-kernel/index.html">TrueVFS Kernel</a> will then enumerate the available file system drivers in order to register their canonical archive file extensions and make this mapping available for the initial setup of the client API module <a href="./index.html">TrueVFS Access</a>. To see the list of canonical archive file extensions, please consult the documentation of the respective file system driver module, e.g. <a href="../truevfs-driver/truevfs-driver-zip/index.html">TrueVFS Driver ZIP</a>.</p>
<p>So if you use Maven, you just need to add the driver modules as dependencies to your POM like this:</p>
<div class="source">
<pre>&lt;project&gt;
  ...
  &lt;dependencies&gt;
    ...
    &lt;dependency&gt;
      &lt;groupId&gt;net.java.truevfs&lt;/groupId&gt;
      &lt;artifactId&gt;truevfs-driver-zip&lt;/artifactId&gt;
      &lt;version&gt;0.12.0&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;</pre></div>
<p>However, if you want to change any of these defaults, then you may need some more insight which is given in this article.</p>
<div class="section">
<h3><a name="The_TConfig_class"></a>The TConfig class</h3>
<p>The class <a href="../apidocs/net/java/truevfs/access/TConfig.html"><tt>TConfig</tt></a> implements an <i>inheritable thread local configuration stack</i>. That's a lot to digest, so let's digest it bite for bite:</p>
<ul>
<li><tt>TConfig</tt> instances are configuration elements with properties which can get queried and updated by the application, e.g. via <a href="../apidocs/net/java/truevfs/access/TConfig.html#getArchiveDetector"><tt>TConfig.getArchiveDetector()</tt></a> or <a href="../apidocs/net/java/truevfs/access/TConfig.html#setArchiveDetectornet.java.truevfs.access.TArchiveDetector"><tt>TConfig.setArchiveDetector(TArchiveDetector)</tt></a>.</li>
<li>It's a stack because an application can push and pop configuration elements by calling <a href="../apidocs/net/java/truevfs/access/TConfig.html#open"><tt>TConfig.open()</tt></a> and <a href="../apidocs/net/java/truevfs/access/TConfig.html#open"><tt>TConfig.close()</tt></a> respectively.</li>
<li>It's thread local because each thread maintains its own stack.</li>
<li>It's inheritable because new threads inherit the top element from the thread local configuration stack of their parent thread. However, child threads cannot pop this element off their thread local stack.</li></ul>
<p>This class also maintains a <i>global configuration</i> which is used whenever the inheritable thread local configuration stack is empty. As the name implies, this configuration element gets shared by all threads, so accessing it is not thread-safe!</p>
<p>Last, but not least, this class also maintains a <i>current configuration</i> for each thread. This is simply the top element of the thread local stack or the global configuration if and only if the thread local stack is empty. A thread can obtain its current configuration by calling <a href="../apidocs/net/java/truevfs/access/TConfig.html#current"><tt>TConfig.current()</tt></a>:</p>
<p><b>Disclaimer</b>: Although this classes internally uses a <tt>java.lang.InheritableThreadLocal</tt>, it does not leak memory in multi class loader environments when used appropriately.</p>
<p>Given these properties, there are two canonical use cases:</p>
<div class="section">
<h4><a name="Customizing_the_configuration_for_the_entire_application"></a>Customizing the configuration for the entire application</h4>
<p>In order to customize the configuration for the entire application you would need to change the global configuration. Because the global configuration is identical to the current configuration at application startup, you could simply do this as follows:</p>
<div class="source">
<pre>TConfig config = TConfig.current();
config.setAccessPreference(FsAccessOption.GROW, true);</pre></div>
<p>This example changes the current configuration. The option <tt>GROW</tt> will cause any subsequent update to existing archive entries to get appended to their archive file rather than triggering a full update. If this code gets called at application startup, it would change the global configuration for subsequent use by all threads.</p></div>
<div class="section">
<h4><a name="Customizing_the_configuration_for_isolated_operations"></a>Customizing the configuration for isolated operations</h4>
<p>Sometimes you may want to customize the current configuration for some isolated file system operations. This is best done with thread local temporary scope as follows:</p>
<div class="source">
<pre>try (TConfig config = TConfig.open()) {
    config.setAccessPreference(FsAccessOption.ENCRYPT, true);
    TFile src = new TFile(&quot;directory&quot;);
    TFile dst = new TFile(&quot;secret.zip&quot;);
    src.cp_rp(dst); // creates a WinZip AES encrypted ZIP file
}</pre></div>
<p>This example pushes a copy of the current configuration onto the inheritable thread local configuration stack and changes it. The option <tt>ENCRYPT</tt> will cause the subsequent copy operation to create a WinZip AES encrypted ZIP file. Note that the updated configuration gets automatically popped off the inheritable thread local configuration stack at the end of the try-block, thereby restoring the previous configuration.</p></div></div>
<div class="section">
<h3><a name="The_TArchiveDetector_class"></a>The TArchiveDetector class</h3>
<p>The task of the class <a href="../apidocs/net/java/truevfs/access/TArchiveDetector.html"><tt>TArchiveDetector</tt></a> is to scan path names for archive file extensions and map it to the respective <a href="../apidocs/net/java/truevfs/kernel/spec/FsDriver.html"><tt>FsDriver</tt></a> class. For example, it could detect the file extension <tt>jar</tt> in the path name <tt>directory/lib.jar</tt> and map it to the class <a href="../apidocs/net/java/truevfs/driver/zip/JarDriver.html"><tt>JarDriver</tt></a>.</p>
<p><tt>TArchiveDetector</tt> provides many options to customize the archive detection:</p>
<ul>
<li>The predefined object <a href="../apidocs/net/java/truevfs/access/TArchiveDetector.html#NULL"><tt>TArchiveDetector.NULL</tt></a> detects no archive file extensions at all.</li>
<li>The predefined object <a href="../apidocs/net/java/truevfs/access/TArchiveDetector.html#ALL"><tt>TArchiveDetector.ALL</tt></a> detects all archive file extensions which can get mapped by enumerating the file system drivers on the class path at run time. Please consult the documentation of the individual driver modules for the list of registered archive file extensions.</li>
<li>The constructor <a href="../apidocs/net/java/truevfs/access/TArchiveDetector.html#TArchiveDetectorjava.lang.String"><tt>TArchiveDetector(String extensions)</tt></a> lets you filter the list of archive file extensions known by <tt>TArchiveDetector.ALL</tt>. This enables you to limit the set of all archive file extensions registered by all file system driver modules on the run time class path.</li>
<li>The constructor <a href="../apidocs/net/java/truevfs/access/TArchiveDetector.html#TArchiveDetectorjava.lang.String_net.truevfs.kernel.FsDriver"><tt>TArchiveDetector(String extensions, FsDriver driver)</tt></a> lets you define a custom list of archive file extensions for any archive driver. This enables you to define a custom <a href="./usecases/aff.html">application file format</a>.</li></ul>
<p>For example, the following code would map the file extensions <tt>foo</tt> and <tt>bar</tt> to the archive driver for JAR files in order to define a custom application file format and update the current configuration with it:</p>
<div class="source">
<pre>TArchiveDetector detector = new TArchiveDetector(&quot;foo|bar&quot;, new JarDriver());
TConfig.current().setArchiveDetector(detector);</pre></div>
<p>Mind that this example changes the current configuration, which is identical to the global configuration at application startup.</p>
<p>Please consult the <a href="../apidocs/net/java/truevfs/access/TArchiveDetector.html">Javadoc</a> for even more constructor options.</p></div>
<div class="section">
<h3><a name="The_TFile_and_TPath_classes"></a>The TFile and TPath classes</h3>
<p>Whenever an object of the class <a href="../apidocs/net/java/truevfs/access/TFile.html"><tt>TFile</tt></a> or <a href="../apidocs/net/java/truevfs/access/TPath.html"><tt>TPath</tt></a> gets instantiated, it gets initialized with a <tt>TArchiveDetector</tt> to scan its path name for prospective archive files. Note that these classes are immutable, so once an instance has been created you cannot change its archive detector and hence its behavior.</p>
<p>The <tt>TFile</tt> class provides multiple overloaded constructors and factory methods, e.g. <a href="../apidocs/net/java/truevfs/access/TFile.html#listFiles"><tt>TFile.listFiles()</tt></a>. Most of these come in pairs: One variant with and one variant without an additional <tt>TArchiveDetector</tt> parameter for initialization.</p>
<p>If you don't provide a <tt>TArchiveDetector</tt> parameter to a <tt>TFile</tt> constructor or factory method, then the instance gets initialized with the <i>current archive detector</i>. The current archive detector can get obtained or changed by respectively calling <a href="../apidocs/net/java/truevfs/access/TConfig.html#getArchiveDetector"><tt>TConfig.current().getArchiveDetector()</tt></a> or <a href="../apidocs/net/java/truevfs/access/TConfig.html#setArchiveDetectornet.truevfs.file.TArchiveDetector"><tt>TConfig.current().setArchiveDetector(detector)</tt></a>.</p>
<p>The <tt>TPath</tt> class has no such provisions because the <tt>java.nio.file.Files</tt> class couldn't use it anyway. So the <tt>TPath</tt> class is always initialized with the current archive detector.</p></div>
<div class="section">
<h3><a name="Initial_setup"></a>Initial setup</h3>
<p>The global configuration gets initialized with <a href="../apidocs/net/java/truevfs/access/TArchiveDetector.html#ALL"><tt>TArchiveDetector.ALL</tt></a> as its <a href="../apidocs/net/java/truevfs/access/TConfig.html#getArchiveDetector">archive detector</a> and <tt>net.java.truevfs.kernel.spec.FsAccessOption.CREATE_PARENTS</tt> as its <a href="../apidocs/net/java/truevfs/access/TConfig.html#getAccessPreferences">sole access preference</a>. This enables the following simple code for creating an archive entry to work as expected if the JAR of the module TrueVFS Driver ZIP is present on the class path at run time:</p>
<div class="source">
<pre>File entry = new TFile(&quot;archive.zip/dir/H&#xe4;lloW&#xf6;rld.txt&quot;);
try (Writer writer = new TFileWriter(entry)) {
    writer.write(&quot;Hello world!\n&quot;);
}</pre></div>
<p>Without the option <tt>CREATE_PARENTS</tt>, you would have to call <a href="../apidocs/net/java/truevfs/access/TFile.html#mkdirs"><tt>TFile.mkdirs()</tt></a> first in order to create <tt>&quot;archive.zip/dir&quot;</tt> and without the archive detector <tt>ALL</tt>, <tt>&quot;archive.zip&quot;</tt> would get created as a regular directory.</p></div>
<div class="section">
<h3><a name="The_TApplication_class"></a>The TApplication class</h3>
<p>The class <a href="../apidocs/net/java/truevfs/access/TApplication.html"><tt>TApplication</tt></a> is a simple template class which aids you in implementing the typical lifecycle of a TrueVFS application. Consider the following example:</p>
<div class="source">
<pre>class MyApplication extends TApplication&lt;IOException&gt; {

    public static void main(String[] args) throws IOException {
        System.exit(new MyApplication().run(args));
    }

    @Override
    protected void setup() {
        TConfig config = TConfig.get();
        config.setArchiveDetector(new TArchiveDetector(&quot;aff&quot;, new JarDriver()));
        config.setAccessPreference(FsOutputOption.GROW, true);
    }

    ...
}</pre></div>
<p>Here, the current configuration is changed to contain a custom archive detector for an application file format and the option <tt>GROW</tt> in addition to the default option <tt>CREATE_PARENTS</tt>. By overriding <a href="../apidocs/net/java/truevfs/access/TApplication.html#setup"><tt>TApplication.setup()</tt></a>, it can be safely assumed that there is no enclosing <tt>TConfig.open|close()</tt> and hence <tt>config</tt> indeed refers to the global configuration.</p></div></div>
              </div>
    </div>
    <div class="clear"><hr/></div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2005-2018
                        <a href="http://schlichtherle.de">Schlichtherle IT Services</a>.
            All Rights Reserved.      
                                   <span id="publishDate">Last Published: 2018-06-01</span>
                        </div>
      <div class="clear"><hr/></div>
    </div>
  </body>
</html>
