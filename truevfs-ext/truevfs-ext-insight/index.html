<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <link href="./css/prettify.css" type="text/css" rel="stylesheet"/>
    <script src="./js/prettify.js" type="text/javascript"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>TrueVFS Extension Insight &#x2013; About</title>
    <style type="text/css" media="all">
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print"/>
    <meta name="author" content="Christian Schlichtherle"/>
    <meta name="Date-Revision-yyyymmdd" content="20170919"/>
    <meta http-equiv="Content-Language" content="en"/>
          <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-25500668-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
                  <script>
        (function() {
          var cx = '003580521944097984334:8uinm6tpaz4';
          var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
          gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
              '//www.google.com/cse/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
        })();
      </script>
                                                          
<link title="The TrueZIP Blog - Announcements Feed" rel="alternate" type="application/rss+xml" href="http://truevfs.schlichtherle.de/category/announcements/feed/"/>
                      
  </head>
  <body class="composite" onload="prettyPrint()">
    <div id="banner">
                    <div id="bannerLeft">
                TrueVFS Extension Insight
                </div>
                                <div id="gcse-search-form" class="gcse-searchbox-only"></div>
            <div class="clear"><hr/></div>
    </div>
    <div id="breadcrumbs">
            
                                  <div class="xleft">
        <span id="projectVersion">Version: 0.12.0</span>
                  |                         <a href="../../index.html" title="TrueVFS">TrueVFS</a>
      &raquo;
                        <a href="../" title="TrueVFS Extension">TrueVFS Extension</a>
      &raquo;
                            <a href="./" title="TrueVFS Extension Insight">TrueVFS Extension Insight</a>
      &raquo;
      TrueVFS Extension Insight &#x2013; About
              </div>
            <div class="xright">        
                        </div>
      <div class="clear"><hr/></div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
              
                                                   <h5>Parent Module</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="TrueVFS Extension">TrueVFS Extension</a>
            </li>
          </ul>
                       <h5>Sub-Modules</h5>
                                 <h5>Reports</h5>
                  <ul>
                                                                                                                                                                                                                                                                                    <li class="expanded">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                    <ul>
                      <li class="none">
                          <a href="dependencies.html" title="Dependencies">Dependencies</a>
            </li>
                      <li class="none">
                          <a href="dependency-info.html" title="Dependency Information">Dependency Information</a>
            </li>
                      <li class="none">
                          <a href="dependency-management.html" title="Dependency Management">Dependency Management</a>
            </li>
                      <li class="none">
                          <a href="distribution-management.html" title="Distribution Management">Distribution Management</a>
            </li>
                      <li class="none">
            <strong>About</strong>
          </li>
                      <li class="none">
                          <a href="issue-tracking.html" title="Issue Management">Issue Management</a>
            </li>
                      <li class="none">
                          <a href="license.html" title="Licenses">Licenses</a>
            </li>
                      <li class="none">
                          <a href="plugin-management.html" title="Plugin Management">Plugin Management</a>
            </li>
                      <li class="none">
                          <a href="plugins.html" title="Plugins">Plugins</a>
            </li>
                      <li class="none">
                          <a href="team-list.html" title="Team">Team</a>
            </li>
                      <li class="none">
                          <a href="source-repository.html" title="Source Code Management">Source Code Management</a>
            </li>
                      <li class="none">
                          <a href="project-summary.html" title="Summary">Summary</a>
            </li>
              </ul>
        </li>
                                                                                      <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                     
<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
  <div class="paypalButton">
    <input name="cmd" value="_s-xclick" type="hidden"/>
    <input name="hosted_button_id" value="AGDEQWWKNZ6UL" type="hidden"/>
    <input style="border: 0" alt="PayPal - The safer, easier way to pay online!" name="submit" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" type="image"/>
  </div>
</form>
                                
                              </div>
    </div>
    <div id="bodyColumn" class="content">
      <div id="contentBox">
                                      <div class="section">
<h2><a name="About"></a>About</h2>
<p>Instruments the TrueVFS Kernel for statistics monitoring via JMX.</p>
<div class="section">
<h3><a name="Usage"></a>Usage</h3>
<p>Add the JAR artifact of this module to the run time class path to make its services available for service location in the client API modules.</p>
<p>When using Maven, add the following to your <tt>pom.xml</tt> file:</p>
<div class="source">
<pre>&lt;project    xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
            xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
            xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    ...
    &lt;dependencies&gt;
        ...
        &lt;dependency&gt;
            &lt;groupId&gt;net.java.truevfs&lt;/groupId&gt;
            &lt;artifactId&gt;truevfs-ext-insight&lt;/artifactId&gt;
            &lt;version&gt;0.12.0&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;</pre></div></div>
<div class="section">
<h3><a name="Sample"></a>Sample</h3>
<p><b>TODO</b>: This section still reflects TrueZIP Extension JMX/JUL and needs an update.</p>
<p>To demonstrate this module, let's use the <tt>Tree</tt> class generated by the TrueVFS Archetype File*. This class simply prints an ASCII directory tree of a directory and then terminates. When run unchanged with no arguments in the project directory of the generated archetype, it's output may look like this:</p>
<div class="source">
<pre>.
|-- nbactions.xml
|-- pom.xml
|-- src
|   `-- main
|       `-- java
|           `-- de
|               `-- schlichtherle
|                   `-- mavenproject1
|                       |-- Application.java
|                       |-- Cat.java
|                       |-- Copy.java
|                       |-- Pickr.java
|                       `-- Tree.java
|-- target
|   |-- classes
|   |   `-- de
|   |       `-- schlichtherle
|   |           `-- mavenproject1
|   |               |-- Application.class
|   |               |-- Cat.class
|   |               |-- Copy.class
|   |               |-- Pickr$1.class
|   |               |-- Pickr.class
|   |               `-- Tree.class
|   |-- generated-sources
|   |   `-- annotations
|   |-- maven-archiver
|   |   `-- pom.properties
|   `-- mavenproject1-1.0-SNAPSHOT.jar
|       |-- de
|       |   `-- schlichtherle
|       |       `-- mavenproject1
|       |           |-- Application.class
|       |           |-- Cat.class
|       |           |-- Copy.class
|       |           |-- Pickr$1.class
|       |           |-- Pickr.class
|       |           `-- Tree.class
|       `-- META-INF
|           |-- MANIFEST.MF
|           `-- maven
|               `-- de.schlichtherle
|                   `-- mavenproject1
|                       |-- pom.properties
|                       `-- pom.xml
`-- test.jar
    |-- archive.tar
    |   `-- pom.xml
    |-- archive.tar.gz
    |   `-- pom.xml
    |-- archive.zip
    |   `-- pom.xml
    |-- pom.xml
    `-- the-password-is-test1234.tzp
        `-- pom.xml</pre></div>
<p>As you see, the <tt>Tree</tt> class recursively prints the (virtual) directory structure of the archive files <tt>mavenproject1-1.0-SNAPSHOT.jar</tt> and <tt>test.jar</tt> with its enclosed archive files.</p>
<p>It was said initially that you could use this module without changing the client application code. However, the <tt>Tree</tt> class terminates immediately before you would even have a chance to connect to the JVM with JConsole or JVisualVM. So let's add the following method to the base class <tt>Application</tt>:</p>
<div class="source">
<pre>@Override
protected void sync() throws FsSyncException {
    try {
        Thread.sleep(Long.MAX_VALUE);
    } catch (InterruptedException ok) {
    }
    super.sync();
}</pre></div>
<p>This will not only make the <tt>Tree</tt> class run forever, it will also prevent it from unmounting the archive files, so that you have something to monitor and manage in the JConsole.</p>
<div class="section">
<h4><a name="The_MXBeans"></a>The MXBeans</h4>
<p>Now, when running the tweaked utility, you see the output above and then the utility halts. Next, let's start JConsole and connect it to the JVM running the <tt>Tree</tt> class. When changing to the MBeans tab, you can now see some nice MXBeans for TrueVFS. Each of the MXBean classes provide attributes and operations with descriptions so you can figure what's going on.</p>
<p>The <tt>FsManager</tt> MXBean represents the singleton file system manager:</p><img src="01_FsManager.png" alt="FsManager MXBean" />
<p>It has two operations, one for unmounting all archive files and one for clearing all but the last I/O statistics.</p>
<p>The <tt>FsModel</tt> MXBeans represent federated file systems alias archive file systems:</p><img src="02_FsModel.png" alt="FsModel MXBeans" />
<p>Because the <tt>Tree</tt> class has found six archive files in the directory tree, we see six MXBeans, one for each mounted archive file. Each MXBean provides one operation for unmounting the respecting archive file.</p>
<p>Last but not least, the <tt>IOPool$Entry</tt> MXBeans represent temporary files:</p><img src="03_IOPool$Entry.png" alt="IOPool$Entry MXBeans" />
<p>It may be hard to follow, but one temporary file is required for each enclosed ZIP file - so in this case two temporary files for the file <tt>archive.zip</tt> and <tt>the-password-is-test1234.tzp</tt> within <tt>test.jar</tt>. Furthermore, because the TAR file format does not have a central directory, the TAR drivers unroll each TAR file when mounting them - so in this case two more temporary files for the file <tt>pom.xml</tt> in <tt>archive.tar</tt> and <tt>archive.tar.gz</tt> within <tt>test.jar</tt>.</p>
<p>Now you can inspect the attribute descriptions and values and/or you can use the <tt>umount</tt>/<tt>clearStatistics</tt> operations:</p><img src="04_FsManager.umount.png" alt="umount() operation" />
<p>I need to add a few points, though:</p>
<ul>
<li>If <tt>umount</tt> gets called on an <tt>FsModel</tt> MXBean, then the virtual file system for the respective archive file and <i>all enclosed</i> archive files get unmounted. So if called on <tt>test.jar</tt>, then <tt>archive.tar</tt>, <tt>archive.tar.gz</tt>, <tt>archive.zip</tt> and <tt>the-password-is-test1234.tzp</tt> get unmounted, too. With earlier TrueVFS versions, the filtering doesn't work correctly and accidentally all archive files may get unmounted.</li>
<li>If <tt>umount</tt> gets called on the <tt>FsManager</tt> MXBean, then all federated file systems get unmounted.</li>
<li>In any case, this will only work if the federated file systems are idle! If any file system is busy doing I/O, then you will get a <tt>FsSyncException</tt>. So calling this operation is safe.</li></ul>
<p>Once you unmount a federated file system, its respective <tt>FsModel</tt> and <tt>IOPool$Entry</tt> MXBeans vanish automagically. So you only see the stuff which keeps TrueVFS busy.</p></div></div></div>
              </div>
    </div>
    <div class="clear"><hr/></div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2005-2017
                        <a href="http://schlichtherle.de">Schlichtherle IT Services</a>.
            All Rights Reserved.      
                                   <span id="publishDate">Last Published: 2017-09-19</span>
                        </div>
      <div class="clear"><hr/></div>
    </div>
  </body>
</html>
